# This config replicates the results of the ChangeVit paper on the LEVIR-CD dataset.
model:
  class_path: ChangeDetectionTask
  init_args:
    model: 'changevit_small'
    task: 'binary'
    loss: 'bce'
    lr: 2e-4
    num_classes: 2
data:
  class_path: LEVIRCDDataModule
  init_args:
    batch_size: 4 #with 24GB VRAM on RTX 4090 small: bs=4 / tiny: bs=10
    patch_size: 256
    num_workers: 4
    stride: 256
    dataset_variant: 'levircd'
  dict_kwargs:
    root: 'data'

trainer:
  max_steps: 80000
  accelerator: auto
  devices: 1
  check_val_every_n_epoch: 1
  log_every_n_steps: 10
  enable_progress_bar: true
  logger:
    class_path: lightning.pytorch.loggers.WandbLogger
    init_args:
      name: 'changevit_small_levircd_benchmark'
      project: 'torchgeo-changevit'
  callbacks:
    - class_path: lightning.pytorch.callbacks.RichModelSummary
      init_args:
        max_depth: 2
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        monitor: 'val_BinaryF1Score'
        mode: 'max'
        save_top_k: 3
        filename: 'changevit_s_levircd_{step}_{val_BinaryF1Score:.4f}'
        verbose: true
    - class_path: lightning.pytorch.callbacks.LearningRateMonitor
      init_args:
        logging_interval: 'step'

optimizer:
  class_path: torch.optim.Adam
  init_args:
    lr: 2e-4
    betas: [0.9, 0.99]
    weight_decay: 1e-4

lr_scheduler:
  class_path: torch.optim.lr_scheduler.PolynomialLR
  init_args:
    total_iters: 80000
    power: 0.9
